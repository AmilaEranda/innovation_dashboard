<!DOCTYPE html>
<%
var user = require('/modules/user.js').current();
if (!user) {
    response.sendRedirect('/userforms/login');
}else{%>
<%var year=new Date().getFullYear();var formtype=request.getParameter("formtype");%>
<%if(formtype==null|formtype!="jour"&formtype!="book"&formtype!="tech"&formtype!="conf"){response.sendRedirect("mainprofile.jag");}else{%>
<%include('db.jag');%>
<%include("mailconverter.jag");%>
<%include("researchareas.jag");%>
<%var username=session.get("LOGGED_IN_USER")+"";%>
<%var person=db.query("SELECT * FROM person WHERE email='"+""+remakeEmail(username)+"'");%>
<%var url="images/users/";url+=(person[0].image_name==""|person[0].image_name==null)?"profile.jpg": person[0].person_id+"/"+person[0].image_name;%>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Innovation | Dashboard</title>
        <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
        <link href="css1/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="css1/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="css1/panel.css" rel="stylesheet" type="text/css" />
        <link type="text/css" rel="stylesheet" href="css1/forms/publications.css" />
        <link href="css1/jquerymessagebox/msgBoxLight.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css1/select2/css/select2.css"/>
        <link rel="stylesheet" type="text/css" href="css1/select2/select2-bootstrap.css"/>
        <link href="css1/datepicker/jquery.datepick.css" rel="stylesheet">
        <script type="text/javascript">
            var rowidentifier=0;
            var rowidentifierpublication=0;
            var tabledata=[];
            var tabledata1=[];
            var mainvalues=<%=db.query("SELECT * FROM area_of_interest ORDER BY name")%>;
            var sub_values=<%=db.query("SELECT * FROM sub_area_of_interest ORDER BY name")%>;
            var sub_sub_values=<%=db.query("SELECT * FROM sub_sub_area_of_interest ORDER BY name")%>;
            var journal_values=<%=db.query("SELECT * FROM journal WHERE status='1'")%>;
            var organization_values=<%=getOrganizationsOfPerson(person[0].person_id)%>;
        </script>
        <style type="text/css">
            .selectwidth{
                width:190px;
            }
            .CSSTableGenerator {
                margin:0px;padding:0px;
                width:100%;
                border:1px solid #3f7f00;
                
                -moz-border-radius-bottomleft:0px;
                -webkit-border-bottom-left-radius:0px;
                border-bottom-left-radius:0px;
                
                -moz-border-radius-bottomright:0px;
                -webkit-border-bottom-right-radius:0px;
                border-bottom-right-radius:0px;
                
                -moz-border-radius-topright:0px;
                -webkit-border-top-right-radius:0px;
                border-top-right-radius:0px;
                
                -moz-border-radius-topleft:0px;
                -webkit-border-top-left-radius:0px;
                border-top-left-radius:0px;
            }.CSSTableGenerator table{
                border-collapse: collapse;
                border-spacing: 0;
                width:100%;
                margin:0px;padding:0px;
            }.CSSTableGenerator tr:last-child td:last-child {
                -moz-border-radius-bottomright:0px;
                -webkit-border-bottom-right-radius:0px;
                border-bottom-right-radius:0px;
            }
            .CSSTableGenerator table tr:first-child td:first-child {
                -moz-border-radius-topleft:0px;
                -webkit-border-top-left-radius:0px;
                border-top-left-radius:0px;
            }
            .CSSTableGenerator table tr:first-child td:last-child {
                -moz-border-radius-topright:0px;
                -webkit-border-top-right-radius:0px;
                border-top-right-radius:0px;
            }.CSSTableGenerator tr:last-child td:first-child{
                -moz-border-radius-bottomleft:0px;
                -webkit-border-bottom-left-radius:0px;
                border-bottom-left-radius:0px;
            }.CSSTableGenerator tr:hover td{
                
            }
            .CSSTableGenerator tr:nth-child(odd){ background-color:#d4ffaa; }
            .CSSTableGenerator tr:nth-child(even)    { background-color:#ffffff; }.CSSTableGenerator td{
                vertical-align:middle;
                border:1px solid #3f7f00;
                border-width:0px 1px 1px 0px;
                text-align:left;
                padding:7px;
                font-size:10px;
                font-family:Arial;
                font-weight:normal;
                color:#000000;
            }.CSSTableGenerator tr:last-child td{
                border-width:0px 1px 0px 0px;
            }.CSSTableGenerator tr td:last-child{
                border-width:0px 0px 1px 0px;
            }.CSSTableGenerator tr:last-child td:last-child{
                border-width:0px 0px 0px 0px;
            }
            .CSSTableGenerator tr:first-child td{
                    background:-o-linear-gradient(bottom, #5fbf00 5%, #3f7f00 100%);    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #5fbf00), color-stop(1, #3f7f00) );
                background:-moz-linear-gradient( center top, #5fbf00 5%, #3f7f00 100% );
                filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#5fbf00", endColorstr="#3f7f00");  background: -o-linear-gradient(top,#5fbf00,3f7f00);

                background-color:#5fbf00;
                border:0px solid #3f7f00;
                text-align:center;
                border-width:0px 0px 1px 1px;
                font-size:14px;
                font-family:Arial;
                font-weight:bold;
                color:#ffffff;
            }
            .CSSTableGenerator tr:first-child:hover td{
                background:-o-linear-gradient(bottom, #5fbf00 5%, #3f7f00 100%);    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #5fbf00), color-stop(1, #3f7f00) );
                background:-moz-linear-gradient( center top, #5fbf00 5%, #3f7f00 100% );
                filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#5fbf00", endColorstr="#3f7f00");  background: -o-linear-gradient(top,#5fbf00,3f7f00);

                background-color:#5fbf00;
            }
            .CSSTableGenerator tr:first-child td:first-child{
                border-width:0px 0px 1px 0px;
            }
            .CSSTableGenerator tr:first-child td:last-child{
                border-width:0px 0px 1px 1px;
            }
        </style>
    </head>
    <body class="skin-blue">        
        <div class="wrapper row-offcanvas row-offcanvas-left">
            <aside class="left-side sidebar-offcanvas" style="margin-top:-50px;">
                <section class="sidebar">
                    <div class="user-panel" style="height: 51px;">
                        <div class="pull-left image">
                            <img src="<%=url%>" class="img-circle" style="margin-top: -5px;" alt="User Image" />
                        </div>
                        <div class="pull-left info">
                            <p><%=(person[0].first_name.length>26)?person[0].first_name.substring(0,25):person[0].first_name%></p>
                        </div>
                    </div>
                    <ul class="sidebar-menu">
                        <li class="active">
                            <a href="mainprofile.jag">
                                <i class="fa fa-group"></i><span>Profile</span>
                            </a>
                        </li>
                        <li class="active">
                            <a href="mainprofilebasicdetails.jag">
                                <i class="fa fa-user"></i><span>Basic Details</span>
                            </a>
                        </li>
                        <li  class="active">
                            <a href="mainprofilepasswordreset.jag">
                                <i class="fa fa-lock"></i><span>Password Reset</span>
                            </a>
                        </li>
                        <li  class="active">
                            <a href="mainprofilecontactdetails.jag">
                                <i class="fa fa-phone"></i><span>Contact Details</span>
                            </a>
                        </li>
                        <li  class="active">
                            <a href="mainprofileorganizationdetails.jag">
                                <i class="fa fa-home"></i><span>Organization details</span>
                            </a>
                        </li>
                        <li class="treeview">
                            <a href="#">
                                <i class="fa fa-laptop"></i>
                                <span>Publications</span>
                                <i class="fa fa-angle-left pull-right"></i>
                            </a>
                            <ul class="treeview-menu">
                                <li><a href="mainprofilepublications.jag?formtype=jour" style="margin-left: 10px;"><i class="fa fa-angle-double-right"></i>Journal Article</a></li>
                                <li><a href="mainprofilepublications.jag?formtype=book" style="margin-left: 10px;"><i class="fa fa-angle-double-right"></i>Book</a></li>
                                <li><a href="mainprofilepublications.jag?formtype=tech" style="margin-left: 10px;"><i class="fa fa-angle-double-right"></i>Technical Report</a></li>
                                <li><a href="mainprofilepublications.jag?formtype=conf" style="margin-left: 10px;"><i class="fa fa-angle-double-right"></i>Conference</a></li>
                            </ul>
                        </li>
                    </ul>
                </section>
            </aside>
            <aside class="right-side">
                <section class="content-header">
                    <h1><%var title=(formtype!=null&&formtype=="jour")?"Journal Article":(formtype!=null&&formtype=="book")?"Research Book":(formtype!=null&&formtype=="tech")?"Technical Report":(formtype!=null&&formtype=="conf")?"Conference Paper":"";%>
                        <div id="titlepage"><%=title%><small>(Add)</small></div>
                    </h1>                  
                </section>
                <section class="content" style="background-repeat: repeat;">
                    <div id="content">
                        <div id="jQGrid"></div> 
                    </div>
                    <div id="formWrapper" class="container roundCorner textColor">
                        <form class="form-horizontal" enctype="multipart/form-data" id="publicationform">
                            <fieldset>
                                <div class="form-group">
                                    <div id="journaldiv">
                                        <label class="control-label col-xs-3">Journal(*)</label>
                                        <div class="col-xs-9">
                                            <select id="journalform" name="journalform" class="select2 input-default" onchange="journalChanger()" style="width:510px;">
                                                <option value="-1">-----------Select-----------</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group" id="journalotherdiv">
                                    <label class="control-label col-xs-3" id="otherjornallabel">Other Journal name(*)</label>
                                    <div class="col-xs-9">
                                        <input id="othernameform" name="othernameform" type="text" placeholder="Other Journal name" class="form-control1 input-md">
                                    </div>
                                </div>
                                <div class="form-group" id="nameformdiv">
                                    <label class="control-label col-xs-3" id="changeLabel1">Name</label>
                                    <div class="col-xs-9">
                                        <input id="nameform" name="nameform" type="<%=(formtype!=null&&formtype=="jour")?"text":(formtype!=null&&formtype=="book")?"hidden":(formtype!=null&&formtype=="tech")?"text":(formtype!=null&&formtype=="conf")?"text":""%>" placeholder="Journal name" class="input-md<%=(formtype!=null&&formtype=="book")?"":" form-control1"%>" style="width:100%;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-3" id="changeLabel2">Article title</label>
                                    <div class="col-xs-9">
                                        <input id="titleform" name="titleform" type="<%=(formtype!=null&&formtype=="jour")?"hidden":(formtype!=null&&formtype=="book")?"text":(formtype!=null&&formtype=="tech")?"hidden":(formtype!=null&&formtype=="conf")?"hidden":""%>" placeholder="Article title" class="input-md<%=(formtype!=null&&formtype=="book")?" form-control1":""%>" style="width:510px;">
                                    </div>
                                </div>                                
                                <div class="form-group">
                                    <label class="control-label col-xs-3">Organization</label>
                                    <div class="col-xs-9">
                                        <select id="organization" name="organization" class="select2" style="width:510px;">
                                            <option value="-1">-----------Select-----------</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="divforavailablepub">
                                <div class="form-group" id="changediv1">
                                    <label class="control-label col-xs-3">Volume No.</label>
                                    <div class="col-xs-3">
                                        <input id="volumenoform" name="volumenoform" type="text" placeholder="Volume Number" class="form-control1 input-md" style="width:210px;">
                                    </div>
                                    <label class="control-label col-xs-2">Issue No.</label>
                                    <div class="col-xs-4">
                                        <input id="issuenoform" name="issuenoform" type="text" placeholder="Issue Number" class="form-control1 input-md">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-3">Editions</label>
                                    <div class="col-xs-9">
                                        <input id="editions" name="editions" type="text" placeholder="Editions" class="form-control1 input-md">
                                    </div>
                                </div>
                                <div class="form-group" id="pagesdiv">
                                    <label class="control-label col-xs-3">Pages</label>
                                    <div class="col-xs-9">
                                        <input id="pages" name="pages" type="text" placeholder="Pages" class="form-control1 input-md">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div id="yearwrapper">
                                        <label class="control-label col-xs-3" for="year">Year(*)</label>
                                        <div class="col-xs-3">
                                            <select id="yearform" name="yearform" class="select2" style="width:170px;">
                                                <%                                            
                                                for (var i = year; i>=1900; i--) {
                                                %>
                                                    <option value="<%=(i)+""%>"><%=i+""%></option>
                                                <%}%>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="monthwrapper" class="col-xs-6">
                                        <label class="control-label col-xs-4">Month</label>
                                        <div class="col-xs-2">
                                            <select id="monthform" name="monthform" class="select2" style="width:205px;">
                                                <option value="0">Select</option>
                                                <option value="1">January</option>
                                                <option value="2">February</option>
                                                <option value="3">March</option>
                                                <option value="4">April</option>
                                                <option value="5">May</option>
                                                <option value="6">June</option>
                                                <option value="7">July</option>
                                                <option value="8">August</option>
                                                <option value="9">September</option>
                                                <option value="10">October</option>
                                                <option value="11">November</option>
                                                <option value="12">December</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="datewrapper">
                                        <label class="control-label col-xs-3" for="date">Date(*)</label>
                                        <div class="col-xs-3">
                                            <input id="datepicker" readonly="readonly" name="datepicker" type="text" class="form-control1 input-md">
                                        </div>
                                    </div>
                                    <div id="isbnnumberwrapper" class="col-xs-6" style="display:none;">
                                        <label class="control-label col-xs-3">ISBN</label>
                                        <div class="col-xs-3">
                                            <input id="isbnno" name="isbnno" type="text" placeholder="ISBN Number" class="form-control1 input-md" style="width:230px;">
                                        </div>
                                    </div>                                    
                                </div>
                                <fieldset>
                                    <legend style="margin-left:20px;">Add Area of interests for <%=title%>(*)</legend>
                                    <div style="margin-left:18px;margin-bottom:20px;padding-bottom:10px;padding-left:5px;padding-right:5px;border: 1px solid green;">
                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Research Area</label>
                                            <label class="control-label col-xs-3">Sub Research Area</label>
                                            <label class="control-label col-xs-1"></label>
                                            <label class="control-label col-xs-2">Area of Interest</label>                                        
                                            <label class="control-label col-xs-2">Add</label>
                                            <label class="control-label col-xs-1" style="margin-left:-20px;">Refresh</label>
                                        </div>
                                        <select id="mainresform" class="selectwidth"></select>
                                        <select id="subresform" class="selectwidth"></select>
                                        <select id="subsubresform" class="selectwidth"></select><button id="addtocollection" type="button" style="width:35px;">Add</button><button type="button" id="refreshbutton"  style="width:50px;">Refresh</button><br/>
                                        <div class="CSSTableGenerator" id="tblData" style="display:none;">
                                            <table>
                                                <tr>
                                                    <th>Research Area&nbsp;</th>
                                                    <th>Sub Research Area&nbsp;</th>
                                                    <th>Area of Interest&nbsp;</th>
                                                    <th>Remove</th>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </fieldset>
                                <fieldset>
                                    <legend style="margin-left:20px;">Add Co-Authors to the Publication</legend>
                                    <div style="margin-left:18px;margin-bottom:20px;padding-bottom:10px;padding-left:5px;padding-right:5px;border: 1px solid green;">
                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Co-Author</label>
                                            <label class="control-label col-xs-2"></label>
                                            <label class="control-label col-xs-3">Organization</label>
                                            <label class="control-label col-xs-2"></label>
                                            <label class="control-label col-xs-1">Add</label>
                                            <label class="control-label col-xs-1"></label>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-5">
                                                <input type="hidden" id="person" name="person" style="width:100%;">
                                            </div>
                                            <div class="col-xs-5">
                                                <select class="select2" style="width:100%;" id="personorganization" name="personorganization"></select>
                                            </div>
                                            <div class="col-xs-2">
                                                <button id="personOrganizationButton" type="button" style="margin-top:3px;margin-left:3px;">Add</button>
                                            </div>
                                        </div>
                                        <div class="CSSTableGenerator" id="tblData1" style="display:none;">
                                            <table>
                                                <tr>
                                                    <th width="45%">Co-Author&nbsp;</th>
                                                    <th width="45%">Organization&nbsp;</th>
                                                    <th width="10%">Remove</th>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </fieldset>
                                <div class="form-group">
                                    <label class="control-label col-xs-3">Upload <%=(formtype!=null&&formtype=="jour")?"Paper":(formtype!=null&&formtype=="book")?"Book":(formtype!=null&&formtype=="tech")?"Report":(formtype!=null&&formtype=="conf")?"Paper":""%></label>
                                    <div class="col-xs-5">
                                        <div style="position:relative;">
                                            <a class='btn btn-primary' href='javascript:;'>
                                                Choose File...
                                                <input type="file" accept='application/pdf' style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' name="file_source" id ="file_source" size="40"  onchange='$("#upload-file-info").html($(this).val());' multiple>
                                            </a>&nbsp;
                                            <span class='label label-info' id="upload-file-info"></span>
                                        </div>
                                    </div>
                                    <div class="col-xs-2"></div>
                                    <div class="col-xs-2"></div>
                                </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-3"></label>
                                    <div class="col-xs-5"></div>
                                    <div class="col-xs-2"></div>
                                    <div class="col-xs-2">
                                        <button id="register" name="register" class="btn btn-primary">Save</button>
                                    </div>
                                </div>
                            </fieldset>
                            <input type="hidden" name="oper" value="addform">
                            <input type='hidden' id="formtype" name="formtype" value="<%=formtype%>"/>
                        </form>                        
                    </div>
                </section>
            </aside>
        </div><br/><br/><br/><br/><br/><br/><br/>
        <script src="js1/jquery/jquery-1.9.1.js"></script>
        <script src="js1/jquerymessagebox/jquery.msgBox.js" type="text/javascript"></script>
        <script src="js1/bootstrap/bootstrap.min.js" type="text/javascript"></script>
        <script src="js1/home/forms.js" type="text/javascript"></script>
        <script src="js1/select2/select2.js"></script>
        <script src="js1/datepicker/jquery.plugin.js"></script>
        <script src="js1/datepicker/jquery.datepick.js"></script>
        <script type="text/javascript">
            $(function(){
                $('#datepicker').datepick({
                    dateFormat:'yyyy-mm-dd',
                    minDate:new Date(1950,1 - 1,26)
                });
                $("#person").select2({
                    placeholder: "Select researchers",
                    minimumInputLength: 2,
                    allowClear: true,
                    formatNoMatches: function (term) {
                        return "Currently we don't have record for this user.Please ask him/her to register.";
                    },
                    ajax: {// instead of writing the function to execute the request we use Select2's convenient helper
                        url: "searchpublication.jag",
                        type: "POST",
                        dataType: 'json',
                        data: function (term, page) {
                            return {
                                persondataget: term, // search term
                                page_limit: 10
                            };
                        },
                        results: function (data, page) {
                            return {results: data.person_data};
                        }
                    },
                    formatResult: formatResult,
                    formatSelection: formatSelection,
                    escapeMarkup: function (m) {
                        return m;
                    }
                });//nameform
                $("#<%=(formtype!=null&&formtype=="jour")?"titleform":(formtype!=null&&formtype=="book")?"nameform":(formtype!=null&&formtype=="tech")?"titleform":(formtype!=null&&formtype=="conf")?"titleform":""%>").select2({
                    placeholder: "Select researchers",
                    minimumInputLength: 2,
                    allowClear: true,
                    //formatNoMatches: function (term) {
                    //    return "<input class='form-control' id='newTerm' value='" + term + "'><a href='#' id='addNew' class='btn btn-default'>Create</a>";
                    //},
                    ajax: {// instead of writing the function to execute the request we use Select2's convenient helper
                        url: "searchpublication.jag",
                        type: "POST",
                        dataType: 'json',
                        data: function (term, page) {
                            return {
                                titledataget: term, // search term
                                pub_type:<%=(formtype!=null&&formtype=="jour")?"1":(formtype!=null&&formtype=="book")?"2":(formtype!=null&&formtype=="tech")?"3":(formtype!=null&&formtype=="conf")?"4":""%>,
                                page_limit: 10
                            };
                        },
                        results: function (data, page) {
                            return {results: data.titleformdata};
                        }
                    },
                    formatResult: formatResultTitle,
                    formatSelection: formatSelectionTitle,
                    escapeMarkup: function (m) {
                        return m;
                    }
                });
            });
            function formatResult(state) {
                var returnval='<img src="'+state.image+'" style="width: 30px;" />'+''+state.text+' '+state.organization+'';
                if(state.text!=''){}
                return returnval;
            }
            function formatSelection(state) {
            	getPersonOrganizations(state.id);
                return state.text;
            }
            function formatResultTitle(state) {            	
                return state.text;
            }
            function formatSelectionTitle(state) {
                if(state.id=="-1"){
                    $("#divforavailablepub").show();
                    if(!$("#divforavailablepub").is(':visible')){
                        $("#journalform").select2("val","");
                        $("#journalform").select2("enable",true);
                        $("#titleform").val("");
                        $("#titleform").prop("disabled", false);
                        $("#nameform").val("");
                        $("#nameform").prop("disabled", false);
                    }
                    return state.text;
                }else{
                    <%if(formtype=="jour"){%>
                        manageAvailableJournal(state);
                    <%}else if(formtype=="book"){%>
                        manageAvailableBook(state);
                    <%}else if(formtype=="tech"){%>
                        manageAvailableTechnicalReports(state);
                    <%}else if(formtype=="conf"){%>
                        manageAvailableConference(state);
                    <%}%>                    
                    return state.text;
                }                
            }
            <%if(formtype=="jour"){%>
                function manageAvailableJournal(state){
                    $("#divforavailablepub").hide();
                    $("#journalform").select2("val",state.value);
                    $("#journalform").select2("disable",true);
                }
            <%}else if(formtype=="book"){%>
                function manageAvailableBook(state){
                    $("#divforavailablepub").hide();
                    $("#titleform").val(state.value);
                    $("#titleform").prop("disabled", true);
                }
            <%}else if(formtype=="tech"){%>
                function manageAvailableTechnicalReports(state){
                    $("#divforavailablepub").hide();
                    $("#nameform").val(state.value);
                    $("#nameform").prop("disabled", true);
                }
            <%}else if(formtype=="conf"){%>
                function manageAvailableConference(state){
                    $("#divforavailablepub").hide();
                    $("#nameform").val(state.value);
                    $("#nameform").prop("disabled", true);
                }
            <%}%>
            function formChanger(val) {
                if (val == 1) {//Journal
                    formViewChanger('Journal name(*)', 'Journal Name', 'Article title(*)', 'Article title', val);
                } else if (val == 2) {//Book
                    formViewChanger('Book name(*)', 'Book Name', 'Publisher(*)', 'Publisher', val);
                } else if (val == 3) {//Tech
                    formViewChanger('Series Name(*)', 'Name', 'Document Title(*)', 'Document Title', val);
                } else {//Conference
                    formViewChanger('Proceeding Name(*)', 'Name', 'Title(*)', 'Title', val);
                }
            }
            function formViewChanger(changeLabel1, placeholder1, changeLabel2, placeholder2, val) {
                $('#changeLabel1').text(changeLabel1);
                $('#nameform').attr("placeholder", placeholder1);
                $('#changeLabel2').text(changeLabel2);
                $('#titleform').attr("placeholder", placeholder2);
                if (val == 1) {//Journal
                    $('#changediv1').show();
                    $('#journaldiv').show();
                    $('#pagesdiv').show();
                    $('#nameformdiv').hide();
                    $('#monthwrapper').show();
                    $('#yearwrapper').show();
                    $('#datewrapper').hide();
                    if($('#journalform option:selected').text()=="Other"){
                        $('#journalotherdiv').show();
                    }else{
                        $('#journalotherdiv').hide();
                    }
                } else if (val == 2) {//Book
                    $('#changediv1').hide();
                    $('#journaldiv').hide();
                    $('#pagesdiv').hide();
                    $('#nameformdiv').show();
                    $('#monthwrapper').hide();
                    $('#isbnnumberwrapper').show();
                    $('#yearwrapper').show();
                    $('#datewrapper').hide();
                } else if (val == 3) {//Tech
                    $('#changediv1').hide();
                    $('#journaldiv').hide();
                    $('#pagesdiv').hide();
                    $('#nameformdiv').show();
                    $('#monthwrapper').show();
                    $('#yearwrapper').show();
                    $('#datewrapper').hide();
                } else if (val == 4) {//Conference
                    $('#changediv1').hide();
                    $('#journaldiv').hide();
                    $('#pagesdiv').show();
                    $('#nameformdiv').show();
                    $('#monthwrapper').show();
                    $('#yearwrapper').show();//datewrapper
                    $('#datewrapper').hide();
                }
            }
            function journalChanger(){
                var journalform = $('#journalform').val();
                if (journalform=='0') {
                	if($("#titleform").val()!=""&&$("#titleform").val()!="-1"){
                		errorMessage("Error","Other journal cannot be have for available journal article.");
            		}else{
            			$('#journalotherdiv').show();
            		}                    
                }else{
                    $('#journalotherdiv').hide();
                }
            }
            var researchareas=<%=getSubResearchAreas()%>;
            $("#publicationform").submit(function(eventObj){
                validateForm();
                return false;
            });
            function validateForm(){
                if($("#formtype").val()=="jour"){
                    validateJournal();
                }else if($("#formtype").val()=="book"){
                    validateBook();
                }else if($("#formtype").val()=="tech"){
                    validateTech();
                }else if($("#formtype").val()=="conf"){
                    validateConf();
                }
            }
            function validateJournal(){
                if($("#divforavailablepub").is(':visible')&&$("#journalform").val()=="-1"){
                    errorMessage("Error","Please select a journal");
                }else if($("#journalform").val()=="0"&$("#othernameform").val()==""){
                    errorMessage("Error","Please Insert Journal name.");
                }else if($("#titleform").val()==""){
                    errorMessage("Error","Please Insert Journal title.");
                }else if($("#organization").val()=="-1"){
                    errorMessage("Error","Please Select your organization.");
                }else if(tabledata.length<1&&$("#divforavailablepub").is(':visible')){
                    errorMessage("Error","Please Insert Area of Interest for the journal");
                }else{
                    submitForm();
                }
            }
            function validateBook(){
                if($("#nameform").val()==""){
                    errorMessage("Error","Please Insert name for the book");
                }else if($("#titleform").val()==""){
                    errorMessage("Error","Please Insert publisher for the book");
                }else if($("#organization").val()=="-1"){
                    errorMessage("Error","Please Select your organization.");
                }else if($("#divforavailablepub").is(':visible')&&tabledata.length<1){
                    errorMessage("Error","Please Insert Area of Interest for the book");
                }else{
                    submitForm();
                }
            }
            function validateTech(){
                if($("#nameform").val()==""){
                    errorMessage("Error","Please Insert name for the technical report");
                }else if($("#titleform").val()==""){
                    errorMessage("Error","Please Insert title for the technical report");
                }else if($("#organization").val()=="-1"){
                    errorMessage("Error","Please Select your organization.");
                }else if($("#divforavailablepub").is(':visible')&&tabledata.length<1){
                    errorMessage("Error","Please Insert Area of Interest for the technical report");
                }else{
                    submitForm();
                }
            }
            function validateConf(){
                if($("#nameform").val()==""){
                    errorMessage("Error","Please Insert name for the conference");
                }else if($("#titleform").val()==""){
                    errorMessage("Error","Please Insert title for the conference");
                }else if($("#organization").val()=="-1"){
                    errorMessage("Error","Please Select your organization.");
                }
                /*else if($("#divforavailablepub").is(':visible')&&$("#datepicker").val()==""){
                    errorMessage("Error","Please Insert date for the conference");
                }*/
                else if($("#divforavailablepub").is(':visible')&&tabledata.length<1){
                    errorMessage("Error","Please Insert Area of Interest for the conference");
                }else{
                    submitForm();
                }
            }
            function submitForm(){
                $("#register").attr('disabled',true);
                $('<input />').attr('type', 'hidden').attr('name', "tabledata").attr('value',JSON.stringify(tabledata)).appendTo('#publicationform');
                $('<input />').attr('type', 'hidden').attr('name', "tabledata1").attr('value',JSON.stringify(tabledata1)).appendTo('#publicationform');
                <%if(formtype!="book"){%>$('<input />').attr('type', 'hidden').attr('name', "title_hidden_value").attr('value',$("#titleform").select2("data").text).appendTo('#publicationform');<%}%>
                <%if(formtype=="book"){%>$('<input />').attr('type', 'hidden').attr('name', "name_hidden_value").attr('value',$("#nameform").select2("data").text).appendTo('#publicationform');<%}%>
                $.ajax({
                    type: "POST",
                    mimeType:"multipart/form-data",
                    contentType: false,
                    cache: false,
                    processData:false,
                    url: 'publicationform.jag',
                    data: new FormData(document.getElementById("publicationform")),
                    success: function(datas)
                    {
                       if ($.trim(datas) == 'true') {
                            successMessage("Done", "Save Successfully");
                            window.setTimeout(function() {
                                document.location.href="mainprofilepublications.jag?formtype=<%=formtype%>";
                            }, 1000);
                        }else{
                        	$("#register").attr('disabled',false);
                            errorMessage("Error",datas);
                        }
                    }
                });
            }
            function errorMessage(title, error) {
                $.msgBox({
                    title: title,
                    content: error
                });
            }
            function successMessage(title, content) {
                $.msgBox({
                    title: title,
                    content: content,
                    type: "info"
                });
            }
            $('.select2').select2({ placeholder : '' });
            $('.select2-remote').select2({ data: [{id:'A', text:'A'}]});
            $('button[data-select2-open]').click(function(){
            $('#' + $(this).data('select2-open')).select2('open');
            });
            $('#journalotherdiv').hide();
            $('#nameformdiv').hide();
            $('#month').addClass("select2 input-default");
            <%  
                if(formtype!=null&&formtype=="jour"){
                    %>
                        formChanger(1);
                    <%
                }else if(formtype!=null&&formtype=="book"){
                    %>
                        formChanger(2);
                    <%
                }else if(formtype!=null&&formtype=="tech"){
                    %>
                        formChanger(3);
                    <%
                }else if(formtype!=null&&formtype=="conf"){
                    %>
                        formChanger(4);
                    <%
                }
            %>
        </script>
        <script type="text/javascript">
            $.each(mainvalues,function(index,object){
                $('#mainresform').append($("<option></option>").attr("value",object.area_of_interest_id).text(object.name));
            });
            $('#journalform').append($("<option></option>").attr("value",0).text("-----Add new Journal-----"));
            $.each(journal_values,function(index,object){
                $('#journalform').append($("<option></option>").attr("value",object.journal_id).text(object.journal_title));
            });            
            $.each(organization_values,function(index,object){
                $('#organization').append($("<option></option>").attr("value",object.organization_id).text(object.name));
            });
            $('#mainresform').change(function(){
                var main=$('#mainresform').val();
                $('#subresform').empty();
                for(var i=0;i<sub_values.length;i++){
                    if(main==sub_values[i].area_of_interest_id){
                        $('#subresform').append($("<option></option>").attr("value",sub_values[i].sub_area_of_interest_id).text(sub_values[i].name));
                    }
                }
                $('#subresform').change();
            });
            $('#subresform').change(function(){
                var sub=$('#subresform').val();
                $('#subsubresform').empty();
                var j=0;
                for(var i=0;i<sub_sub_values.length;i++){
                    if(sub==sub_sub_values[i].sub_area_of_interest_id){
                        j++;
                        $('#subsubresform').append($("<option></option>").attr("value",sub_sub_values[i].sub_sub_area_of_interest_id).text(sub_sub_values[i].name));
                    }
                }
                if(j==0){$('#subsubresform').append($("<option></option>").attr("value",0).text('No Area of Interest'));}
            });
            $('#addtocollection').click(function(){
                if($("#tblData").css('display')=='none'){$("#tblData").show();}
                var dataAvailability=false;
                for(var i=0;i<tabledata.length;i++){
                    if(tabledata[i].matrix==($("#mainresform").val()+","+$("#subresform").val()+","+$("#subsubresform").val())){dataAvailability=true;}
                }
                if(dataAvailability==false){
                    tabledata.push({rowidentifier:rowidentifier,matrix:[$('#mainresform').val(),$('#subresform').val(),$('#subsubresform').val()]});
                    $("#tblData table").append("<tr id='"+rowidentifier+"'>"+"<td>"+$("#mainresform option:selected").text()+"</td>"+"<td>"+$("#subresform option:selected").text()+"</td>"+"<td>"+$("#subsubresform option:selected").text()+"</td>"+"<td><button type='button' onclick='removeTableElement.call("+(rowidentifier++)+")'>Remove</button></td>"+"</tr>");
                }else{
                    errorMessage("Error","You already insert this Field of interest.");
                }
            });
            $("#refreshbutton").click(function(){
                $("#mainresform option:eq(0)").prop('selected',true).change();
            });
            $('#mainresform').change();
            function removeTableElement(){
                if(tabledata.length!=1){
                    $("#"+this).remove();
                    for(var i=0;i<tabledata.length;i++){
                        if(tabledata[i].rowidentifier==this){
                            tabledata.splice(i,1);
                        }
                    }
                }else{
                    errorMessage("Error","You want to have minimum one Area of interest");
                }
            }
            function getPersonOrganizations(person_id){            	
            	$.ajax({
	              type: "POST",
	              url: "searchorganizations.jag",
	              data: {person_id_for_organization:person_id}
	            }).done(function(data) {
	                data=jQuery.parseJSON(data);
	                $('#personorganization').empty();
	                $('#personorganization').append($("<option></option>").attr("value","-1").text("Select Organization"));
	                $.each(data,function(index,object){
		                $('#personorganization').append($("<option></option>").attr("value",object.organization_id).text(object.name));
		            });
		            $("#personorganization").select2("val", "");
	            });
            }
            $("#personOrganizationButton").click(function(){
            	if($("#person").val()==""){
            		errorMessage("Error","Please select a co-author");
            	}else if($("#personorganization").val()==null|$("#personorganization").val()=="-1"){
            		errorMessage("Error","Please select co-author's organization");
            	}else{            		
            		addPersonOrganization($("#person").val(),$("#personorganization").val());
            	}
            });
            function addPersonOrganization(personVariable,personorganizationVariable){
            	var dataAvailability=false;
            	for(var i=0;i<tabledata1.length;i++){
            		if(tabledata1[i].personVariable==personVariable){dataAvailability=true;break;}
            	}
            	if(dataAvailability==false){
            		tabledata1.push({rowidentifier:rowidentifierpublication,personVariable:personVariable,personorganizationVariable:personorganizationVariable});
            		if($("#tblData1").css('display')=='none'){$("#tblData1").show();}
            		$("#tblData1 table").append("<tr id='"+rowidentifierpublication+"'>"+"<td>"+$("#person").select2("data").text+"</td>"+"<td>"+$("#personorganization").select2("data").text+"</td>"+"<td><button type='button' onclick='removeTableElementPublication.call("+(rowidentifierpublication++)+")'>-</button></td>"+"</tr>");
					//$("#person").select2("val", "");
					//$("#personorganization").select2("val", "");
					$('#personorganization').empty();
					$("#personorganization").select2("val", "");
					$("#person").select2("data",null);
            	}else{
            		errorMessage("Error","You already add this co-author");
            	}
            }
            function removeTableElementPublication(){
            	$("#"+this).remove();
            	if(tabledata1.length==1){$("#tblData1").hide();}
                for(var i=0;i<tabledata1.length;i++){
                    if(tabledata1[i].rowidentifier==this){
                        tabledata1.splice(i,1);
                    }
                }
            }
        </script>
    </body>
</html><%}}%>
<%
	function getOrganizationsOfPerson(person_id){
		var organization_values=[];
                var organizations=db.query("SELECT organization_id FROM person_organization WHERE person_id='"+person_id+"'");

                var organizationsfiltered=[];
                var organizationsfilteredindex=0;

                for(var i=0;i<organizations.length;i++){
                	if(i!=0){
                		for(var j=0;j<organizationsfiltered.length;j++){
                			if(organizations[i].organization_id==organizationsfiltered[j]){break;}
                			else if(organizations[i].organization_id!=organizationsfiltered[organizationsfilteredindex]){organizationsfiltered[organizationsfilteredindex++]=organizations[i].organization_id;}
        	        	}
                	}else{
                		organizationsfiltered[organizationsfilteredindex++]=organizations[i].organization_id;
                	}        	
                }
                for(var i=0;i<organizationsfiltered.length;i++){
                	var org=db.query("SELECT organization_id,name FROM organization WHERE organization_id='"+organizationsfiltered[i]+"'");
                	organization_values.push(org[0]);
                }
                return organization_values;
	}
%>